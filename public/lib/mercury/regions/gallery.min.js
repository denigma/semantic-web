(function(){var e,t={}.hasOwnProperty,i=function(e,i){function r(){this.constructor=e}for(var n in i)t.call(i,n)&&(e[n]=i[n]);return r.prototype=i.prototype,e.prototype=new r,e.__super__=i.prototype,e};Mercury.Region.Gallery=function(t){function r(){return e=r.__super__.constructor.apply(this,arguments)}return i(r,t),r.define("Mercury.Region.Gallery","gallery"),r.include(Mercury.Region.Modules.DropIndicator),r.include(Mercury.Region.Modules.DropItem),r.supported=!0,r.elements={controls:".mercury-gallery-region-controls",slides:".slides",paginator:".paginator"},r.events={"click .mercury-gallery-region-controls li":"gotoSlide"},r.prototype.skipHistoryOn=["undo","redo","next","prev","togglePlay"],r.prototype.init=function(){return this.speed||(this.speed=3e3),this.index=0,null==this.playing&&(this.playing=!0),this.refresh(!0)},r.prototype.build=function(){return this.$(".slides").length||this.append('<div class="slides">'),this.$(".paginator").length?void 0:this.append('<div class="paginator">')},r.prototype.value=function(e){var t;return null===e||"undefined"==typeof e?(t=$("<div>").html(this.html()),t.find(".mercury-gallery-region-controls").remove(),t.find(".slide").show(),t.find(".paginator").empty(),t.html()):r.__super__.value.apply(this,arguments)},r.prototype.refresh=function(e){var t=this;return null==e&&(e=!1),clearTimeout(this.timeout),this.images=this.$(".slide").hide(),this.index>this.images.length&&(this.index=1),this.index<1&&(this.index=this.images.length),this.$(".slide:nth-child("+this.index+")").show(),this.refreshPaginator(),e&&this.refreshControls(),this.playing?this.timeout=this.delay(this.speed,function(){return t.nextSlide()}):void 0},r.prototype.refreshPaginator=function(){return this.$paginator.html(Array(this.images.length+1).join("<span>&bull;</span>")),this.$paginator.find("span:nth-child("+this.index+")").addClass("active")},r.prototype.refreshControls=function(){var e,t,i,r,n;for(this.$controls.remove(),this.append('<ul class="mercury-gallery-region-controls"></ul>'),n=this.images,i=0,r=n.length;r>i;i++)e=n[i],t=$(e).find("img").attr("src"),this.$controls.append($('<li><img src="'+t+'"/></li>'));return this.focused?this.$controls.show():void 0},r.prototype.prevSlide=function(){return this.index-=1,this.refresh()},r.prototype.nextSlide=function(){return this.index+=1,this.refresh()},r.prototype.gotoSlide=function(e){return this.index=$(e.target).closest("li").prevAll("li").length+1,this.refresh()},r.prototype.appendSlide=function(e){return this.$slides.append(e),this.refresh(!0),this.pushHistory(),this.trigger("focused")},r.prototype.removeSlide=function(){return this.$(".slide:nth-child("+this.index+")").remove(),this.refresh(!0),this.pushHistory()},r.prototype.onDropFile=function(e){var t,i=this;return t=new(Mercury[this.config("interface:uploader")])(e,{mimeTypes:this.options.mimeTypes}),t.on("uploaded",function(e){return i.focus(),i.handleAction("file",e)})},r.prototype.onFocus=function(){return this.previewing?void 0:this.$controls.show()},r.prototype.onBlur=function(){return this.$controls.hide()},r.prototype.onUndo=function(){return r.__super__.onUndo.apply(this,arguments),this.refresh(!0)},r.prototype.onRedo=function(){return r.__super__.onRedo.apply(this,arguments),this.refresh(!0)},r.prototype.release=function(){return clearTimeout(this.timeout),this.html(this.value()),r.__super__.release.apply(this,arguments)},r}(Mercury.Region),Mercury.Region.Gallery.addToolbar({general:{prev:["Previous Slide"],next:["Next Slide"],remove:["Delete Slide"],togglePlay:["Play/Pause"]}}),Mercury.Region.Gallery.addAction({prev:function(){return this.prevSlide()},next:function(){return this.nextSlide()},remove:function(){return this.removeSlide()},togglePlay:function(){return this.playing=!this.playing,this.refresh()},file:function(e){return e.isImage()?this.handleAction("image",{url:e.get("url")}):void 0},image:function(e){return this.appendSlide('<div class="slide"><img src="'+e.get("url")+'"/></div>')}}),Mercury.Region.Gallery.addContext({togglePlay:function(){return this.playing}})}).call(this);