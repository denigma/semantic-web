(function(){var e={}.hasOwnProperty,t=function(t,i){function r(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t};Mercury.Region.Gallery=function(e){function i(){return i.__super__.constructor.apply(this,arguments)}return t(i,e),i.define("Mercury.Region.Gallery","gallery"),i.include(Mercury.Region.Modules.DropIndicator),i.include(Mercury.Region.Modules.DropItem),i.supported=!0,i.elements={controls:".mercury-gallery-region-controls",slides:".slides",paginator:".paginator"},i.events={"click .mercury-gallery-region-controls li":"gotoSlide"},i.prototype.skipHistoryOn=["undo","redo","next","prev","togglePlay"],i.prototype.init=function(){return this.speed||(this.speed=3e3),this.index=0,null==this.playing&&(this.playing=!0),this.refresh(!0)},i.prototype.build=function(){return this.$(".slides").length||this.append('<div class="slides">'),this.$(".paginator").length?void 0:this.append('<div class="paginator">')},i.prototype.value=function(e){var t;return null===e||"undefined"==typeof e?(t=$("<div>").html(this.html()),t.find(".mercury-gallery-region-controls").remove(),t.find(".slide").show(),t.find(".paginator").empty(),t.html()):i.__super__.value.apply(this,arguments)},i.prototype.refresh=function(e){return null==e&&(e=!1),clearTimeout(this.timeout),this.images=this.$(".slide").hide(),this.index>this.images.length&&(this.index=1),this.index<1&&(this.index=this.images.length),this.$(".slide:nth-child("+this.index+")").show(),this.refreshPaginator(),e&&this.refreshControls(),this.playing?this.timeout=this.delay(this.speed,function(e){return function(){return e.nextSlide()}}(this)):void 0},i.prototype.refreshPaginator=function(){return this.$paginator.html(Array(this.images.length+1).join("<span>&bull;</span>")),this.$paginator.find("span:nth-child("+this.index+")").addClass("active")},i.prototype.refreshControls=function(){var e,t,i,r,n;for(this.$controls.remove(),this.append('<ul class="mercury-gallery-region-controls"></ul>'),n=this.images,i=0,r=n.length;r>i;i++)e=n[i],t=$(e).find("img").attr("src"),this.$controls.append($('<li><img src="'+t+'"/></li>'));return this.focused?this.$controls.show():void 0},i.prototype.prevSlide=function(){return this.index-=1,this.refresh()},i.prototype.nextSlide=function(){return this.index+=1,this.refresh()},i.prototype.gotoSlide=function(e){return this.index=$(e.target).closest("li").prevAll("li").length+1,this.refresh()},i.prototype.appendSlide=function(e){return this.$slides.append(e),this.refresh(!0),this.pushHistory(),this.trigger("focused")},i.prototype.removeSlide=function(){return this.$(".slide:nth-child("+this.index+")").remove(),this.refresh(!0),this.pushHistory()},i.prototype.onDropFile=function(e){var t;return t=new(Mercury[this.config("interface:uploader")])(e,{mimeTypes:this.options.mimeTypes}),t.on("uploaded",function(e){return function(t){return e.focus(),e.handleAction("file",t)}}(this))},i.prototype.onFocus=function(){return this.previewing?void 0:this.$controls.show()},i.prototype.onBlur=function(){return this.$controls.hide()},i.prototype.onUndo=function(){return i.__super__.onUndo.apply(this,arguments),this.refresh(!0)},i.prototype.onRedo=function(){return i.__super__.onRedo.apply(this,arguments),this.refresh(!0)},i.prototype.release=function(){return clearTimeout(this.timeout),this.html(this.value()),i.__super__.release.apply(this,arguments)},i}(Mercury.Region),Mercury.Region.Gallery.addToolbar({general:{prev:["Previous Slide"],next:["Next Slide"],remove:["Delete Slide"],togglePlay:["Play/Pause"]}}),Mercury.Region.Gallery.addAction({prev:function(){return this.prevSlide()},next:function(){return this.nextSlide()},remove:function(){return this.removeSlide()},togglePlay:function(){return this.playing=!this.playing,this.refresh()},file:function(e){return e.isImage()?this.handleAction("image",{url:e.get("url")}):void 0},image:function(e){return this.appendSlide('<div class="slide"><img src="'+e.get("url")+'"/></div>')}}),Mercury.Region.Gallery.addContext({togglePlay:function(){return this.playing}})}).call(this);